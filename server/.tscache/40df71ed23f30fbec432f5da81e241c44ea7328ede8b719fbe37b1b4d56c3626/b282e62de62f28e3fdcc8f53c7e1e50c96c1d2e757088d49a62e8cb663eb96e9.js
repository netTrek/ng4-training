"use strict";
/**
 * File created by suenlue on 16.11.17.
 * Copyright (c) 2017 by netTrek GmbH & Co. KG
 */
Object.defineProperty(exports, "__esModule", { value: true });
var jsonServer = require("json-server");
var authService_1 = require("./authService");
var server = jsonServer.create();
var router = jsonServer.router('./mock/db.json');
var middlewares = jsonServer.defaults();
server.use(jsonServer.bodyParser);
server.get('/auth', authService_1.auth);
server.post('/login', function (req, res) {
    var _a = req.body, username = _a.username, password = _a.password;
    var success = username === 'netTrek' && password === 'netTrek';
    var authorized = success;
    if (success) {
        res.header('authorization', "Bearer netTrek");
        res.status(200);
    }
    else {
        res.status(401);
    }
    res.json({ success: success, authorized: authorized });
});
router.render = function (req, res, next) {
    if (req.url.indexOf('auth') === 0) {
        next();
        return;
    }
    var authorized = false;
    if (req.headers.hasOwnProperty('authorization')) {
        var token = String(req.headers.authorization)
            .replace(/((Bearer)|\s)/gi, '');
        authorized = token === 'netTrek';
    }
    // if ( !authorized ) {
    //   res.status(401).json({ error: 'user is not authorized', authorized: false, success: false  });
    // } else {
    res.header('authorization', "Bearer netTrek");
    res.json({
        data: res.locals.data,
        success: !!res.locals.data && (res.statusCode === 200),
        authorized: authorized
    });
    // }
};
server.use(middlewares);
server.use(router);
server.listen(3000, function () {
    console.log('JSON Server is running on port 3000');
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL3N1ZW5sdWUvV2Vic2l0ZXMvdHJhaW5pbmcvZ2ZuLTIwMTctMTEvZ2ZuL3NlcnZlci9zcmMvc2VydmVyLnRzIiwic291cmNlcyI6WyIvVXNlcnMvc3Vlbmx1ZS9XZWJzaXRlcy90cmFpbmluZy9nZm4tMjAxNy0xMS9nZm4vc2VydmVyL3NyYy9zZXJ2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7QUFFSCx3Q0FBMEM7QUFFMUMsNkNBQXFDO0FBRXJDLElBQU0sTUFBTSxHQUFRLFVBQVUsQ0FBQyxNQUFNLEVBQUcsQ0FBQztBQUN6QyxJQUFNLE1BQU0sR0FBUSxVQUFVLENBQUMsTUFBTSxDQUFHLGdCQUFnQixDQUFFLENBQUM7QUFDM0QsSUFBTSxXQUFXLEdBQUcsVUFBVSxDQUFDLFFBQVEsRUFBRyxDQUFDO0FBRTNDLE1BQU0sQ0FBQyxHQUFHLENBQUcsVUFBVSxDQUFDLFVBQVUsQ0FBRSxDQUFDO0FBRXJDLE1BQU0sQ0FBQyxHQUFHLENBQUcsT0FBTyxFQUFFLGtCQUFJLENBQUUsQ0FBQztBQUU3QixNQUFNLENBQUMsSUFBSSxDQUFHLFFBQVEsRUFBRSxVQUFFLEdBQUcsRUFBRSxHQUFHO0lBQzFCLElBQUEsYUFBaUMsRUFBL0Isc0JBQVEsRUFBRSxzQkFBUSxDQUFjO0lBQ3hDLElBQU0sT0FBTyxHQUFrQixRQUFRLEtBQUssU0FBUyxJQUFJLFFBQVEsS0FBSyxTQUFTLENBQUM7SUFDaEYsSUFBTSxVQUFVLEdBQWUsT0FBTyxDQUFDO0lBQ3ZDLEVBQUUsQ0FBQyxDQUFFLE9BQVEsQ0FBQyxDQUFDLENBQUM7UUFDZCxHQUFHLENBQUMsTUFBTSxDQUFHLGVBQWUsRUFBRSxnQkFBZ0IsQ0FBRSxDQUFDO1FBQ2pELEdBQUcsQ0FBQyxNQUFNLENBQUcsR0FBRyxDQUFFLENBQUM7SUFDckIsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sR0FBRyxDQUFDLE1BQU0sQ0FBRyxHQUFHLENBQUUsQ0FBQztJQUNyQixDQUFDO0lBQ0QsR0FBRyxDQUFDLElBQUksQ0FBRyxFQUFFLE9BQU8sU0FBQSxFQUFFLFVBQVUsWUFBQSxFQUFFLENBQUUsQ0FBQztBQUN2QyxDQUFDLENBQUUsQ0FBQztBQUVKLE1BQU0sQ0FBQyxNQUFNLEdBQUcsVUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUk7SUFFOUIsRUFBRSxDQUFDLENBQUUsR0FBRyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBRSxDQUFDLENBQUMsQ0FBQztRQUNwQyxJQUFJLEVBQUcsQ0FBQztRQUNSLE1BQU0sQ0FBQztJQUNULENBQUM7SUFFRCxJQUFJLFVBQVUsR0FBRyxLQUFLLENBQUM7SUFDdkIsRUFBRSxDQUFDLENBQUUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUcsZUFBZSxDQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3JELElBQU0sS0FBSyxHQUFHLE1BQU0sQ0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBRTthQUMvQyxPQUFPLENBQUcsaUJBQWlCLEVBQUUsRUFBRSxDQUFFLENBQUM7UUFDckMsVUFBVSxHQUFJLEtBQUssS0FBSyxTQUFTLENBQUM7SUFDcEMsQ0FBQztJQUVELHVCQUF1QjtJQUN2QixtR0FBbUc7SUFDbkcsV0FBVztJQUNYLEdBQUcsQ0FBQyxNQUFNLENBQUcsZUFBZSxFQUFFLGdCQUFnQixDQUFFLENBQUM7SUFDakQsR0FBRyxDQUFDLElBQUksQ0FBRztRQUNULElBQUksRUFBSyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUk7UUFDeEIsT0FBTyxFQUFFLENBQUUsQ0FBRSxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksSUFBSSxDQUFFLEdBQUcsQ0FBQyxVQUFVLEtBQUssR0FBRyxDQUFFO1FBQzFELFVBQVUsWUFBQTtLQUNYLENBQUUsQ0FBQztJQUNKLElBQUk7QUFFTixDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsR0FBRyxDQUFHLFdBQVcsQ0FBRSxDQUFDO0FBQzNCLE1BQU0sQ0FBQyxHQUFHLENBQUcsTUFBTSxDQUFFLENBQUM7QUFHdEIsTUFBTSxDQUFDLE1BQU0sQ0FBRyxJQUFJLEVBQUU7SUFDcEIsT0FBTyxDQUFDLEdBQUcsQ0FBRyxxQ0FBcUMsQ0FBRSxDQUFDO0FBQ3hELENBQUMsQ0FBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBGaWxlIGNyZWF0ZWQgYnkgc3Vlbmx1ZSBvbiAxNi4xMS4xNy5cbiAqIENvcHlyaWdodCAoYykgMjAxNyBieSBuZXRUcmVrIEdtYkggJiBDby4gS0dcbiAqL1xuXG5pbXBvcnQgKiBhcyBqc29uU2VydmVyIGZyb20gJ2pzb24tc2VydmVyJztcblxuaW1wb3J0IHsgYXV0aCB9IGZyb20gJy4vYXV0aFNlcnZpY2UnO1xuXG5jb25zdCBzZXJ2ZXIgICAgICA9IGpzb25TZXJ2ZXIuY3JlYXRlICgpO1xuY29uc3Qgcm91dGVyICAgICAgPSBqc29uU2VydmVyLnJvdXRlciAoICcuL21vY2svZGIuanNvbicgKTtcbmNvbnN0IG1pZGRsZXdhcmVzID0ganNvblNlcnZlci5kZWZhdWx0cyAoKTtcblxuc2VydmVyLnVzZSAoIGpzb25TZXJ2ZXIuYm9keVBhcnNlciApO1xuXG5zZXJ2ZXIuZ2V0ICggJy9hdXRoJywgYXV0aCApO1xuXG5zZXJ2ZXIucG9zdCAoICcvbG9naW4nLCAoIHJlcSwgcmVzICkgPT4ge1xuICBjb25zdCB7IHVzZXJuYW1lLCBwYXNzd29yZCB9ID0gcmVxLmJvZHk7XG4gIGNvbnN0IHN1Y2Nlc3MgICAgICAgICAgICAgICAgPSB1c2VybmFtZSA9PT0gJ25ldFRyZWsnICYmIHBhc3N3b3JkID09PSAnbmV0VHJlayc7XG4gIGNvbnN0IGF1dGhvcml6ZWQgICAgICAgICAgICAgPSBzdWNjZXNzO1xuICBpZiAoIHN1Y2Nlc3MgKSB7XG4gICAgcmVzLmhlYWRlciAoICdhdXRob3JpemF0aW9uJywgYEJlYXJlciBuZXRUcmVrYCApO1xuICAgIHJlcy5zdGF0dXMgKCAyMDAgKTtcbiAgfSBlbHNlIHtcbiAgICByZXMuc3RhdHVzICggNDAxICk7XG4gIH1cbiAgcmVzLmpzb24gKCB7IHN1Y2Nlc3MsIGF1dGhvcml6ZWQgfSApO1xufSApO1xuXG5yb3V0ZXIucmVuZGVyID0gKCByZXEsIHJlcywgbmV4dCApID0+IHtcblxuICBpZiAoIHJlcS51cmwuaW5kZXhPZignYXV0aCcpID09PSAwICkge1xuICAgIG5leHQgKCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbGV0IGF1dGhvcml6ZWQgPSBmYWxzZTtcbiAgaWYgKCByZXEuaGVhZGVycy5oYXNPd25Qcm9wZXJ0eSAoICdhdXRob3JpemF0aW9uJyApICkge1xuICAgIGNvbnN0IHRva2VuID0gU3RyaW5nICggcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbiApXG4gICAgICAucmVwbGFjZSAoIC8oKEJlYXJlcil8XFxzKS9naSwgJycgKTtcbiAgICBhdXRob3JpemVkICA9IHRva2VuID09PSAnbmV0VHJlayc7XG4gIH1cblxuICAvLyBpZiAoICFhdXRob3JpemVkICkge1xuICAvLyAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICd1c2VyIGlzIG5vdCBhdXRob3JpemVkJywgYXV0aG9yaXplZDogZmFsc2UsIHN1Y2Nlc3M6IGZhbHNlICB9KTtcbiAgLy8gfSBlbHNlIHtcbiAgcmVzLmhlYWRlciAoICdhdXRob3JpemF0aW9uJywgYEJlYXJlciBuZXRUcmVrYCApO1xuICByZXMuanNvbiAoIHtcbiAgICBkYXRhICAgOiByZXMubG9jYWxzLmRhdGEsXG4gICAgc3VjY2VzczogISAhIHJlcy5sb2NhbHMuZGF0YSAmJiAoIHJlcy5zdGF0dXNDb2RlID09PSAyMDAgKSxcbiAgICBhdXRob3JpemVkXG4gIH0gKTtcbiAgLy8gfVxuXG59O1xuXG5zZXJ2ZXIudXNlICggbWlkZGxld2FyZXMgKTtcbnNlcnZlci51c2UgKCByb3V0ZXIgKTtcblxuXG5zZXJ2ZXIubGlzdGVuICggMzAwMCwgKCkgPT4ge1xuICBjb25zb2xlLmxvZyAoICdKU09OIFNlcnZlciBpcyBydW5uaW5nIG9uIHBvcnQgMzAwMCcgKTtcbn0gKTtcblxuIl19